
var createFutharkModule = (function() {
  var _scriptDir = typeof document !== 'undefined' && document.currentScript ? document.currentScript.src : undefined;
  if (typeof __filename !== 'undefined') _scriptDir = _scriptDir || __filename;
  return (
function(createFutharkModule) {
  createFutharkModule = createFutharkModule || {};

var Module=typeof createFutharkModule!=="undefined"?createFutharkModule:{};var readyPromiseResolve,readyPromiseReject;Module["ready"]=new Promise(function(resolve,reject){readyPromiseResolve=resolve;readyPromiseReject=reject});var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram="./this.program";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function";ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var read_,readAsync,readBinary,setWindowTitle;var nodeFS;var nodePath;if(ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){scriptDirectory=require("path").dirname(scriptDirectory)+"/"}else{scriptDirectory=__dirname+"/"}read_=function shell_read(filename,binary){if(!nodeFS)nodeFS=require("fs");if(!nodePath)nodePath=require("path");filename=nodePath["normalize"](filename);return nodeFS["readFileSync"](filename,binary?null:"utf8")};readBinary=function readBinary(filename){var ret=read_(filename,true);if(!ret.buffer){ret=new Uint8Array(ret)}assert(ret.buffer);return ret};if(process["argv"].length>1){thisProgram=process["argv"][1].replace(/\\/g,"/")}arguments_=process["argv"].slice(2);process["on"]("uncaughtException",function(ex){if(!(ex instanceof ExitStatus)){throw ex}});process["on"]("unhandledRejection",abort);quit_=function(status){process["exit"](status)};Module["inspect"]=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL){if(typeof read!="undefined"){read_=function shell_read(f){return read(f)}}readBinary=function readBinary(f){var data;if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(f))}data=read(f,"binary");assert(typeof data==="object");return data};if(typeof scriptArgs!="undefined"){arguments_=scriptArgs}else if(typeof arguments!="undefined"){arguments_=arguments}if(typeof quit==="function"){quit_=function(status){quit(status)}}if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print;console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!=="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(_scriptDir){scriptDirectory=_scriptDir}if(scriptDirectory.indexOf("blob:")!==0){scriptDirectory=scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1)}else{scriptDirectory=""}{read_=function shell_read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER){readBinary=function readBinary(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=function readAsync(url,onload,onerror){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)}}setWindowTitle=function(title){document.title=title}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.warn.bind(console);for(key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];if(Module["quit"])quit_=Module["quit"];var wasmBinary;if(Module["wasmBinary"])wasmBinary=Module["wasmBinary"];var noExitRuntime;if(Module["noExitRuntime"])noExitRuntime=Module["noExitRuntime"];if(typeof WebAssembly!=="object"){abort("no native wasm support detected")}var wasmMemory;var ABORT=false;var EXITSTATUS;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}var UTF8Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function UTF8ArrayToString(heap,idx,maxBytesToRead){var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heap[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heap.subarray&&UTF8Decoder){return UTF8Decoder.decode(heap.subarray(idx,endPtr))}else{var str="";while(idx<endPtr){var u0=heap[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heap[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heap[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heap[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}return str}function UTF8ToString(ptr,maxBytesToRead){return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;var HEAP64;function updateGlobalBufferAndViews(buf){buffer=buf;Module["HEAP8"]=HEAP8=new Int8Array(buf);Module["HEAP16"]=HEAP16=new Int16Array(buf);Module["HEAP32"]=HEAP32=new Int32Array(buf);Module["HEAPU8"]=HEAPU8=new Uint8Array(buf);Module["HEAPU16"]=HEAPU16=new Uint16Array(buf);Module["HEAPU32"]=HEAPU32=new Uint32Array(buf);Module["HEAPF32"]=HEAPF32=new Float32Array(buf);Module["HEAPF64"]=HEAPF64=new Float64Array(buf);Module["HEAP64"]=HEAP64=new BigInt64Array(buf)}var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||2147418112;var wasmTable;var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;var runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};function abort(what){if(Module["onAbort"]){Module["onAbort"](what)}what+="";err(what);ABORT=true;EXITSTATUS=1;what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(what);readyPromiseReject(e);throw e}function hasPrefix(str,prefix){return String.prototype.startsWith?str.startsWith(prefix):str.indexOf(prefix)===0}var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return hasPrefix(filename,dataURIPrefix)}var fileURIPrefix="file://";function isFileURI(filename){return hasPrefix(filename,fileURIPrefix)}var wasmBinaryFile="mandelbrot.wasm";if(!isDataURI(wasmBinaryFile)){wasmBinaryFile=locateFile(wasmBinaryFile)}function getBinary(){try{if(wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(wasmBinaryFile)}else{throw"both async and sync fetching of the wasm failed"}}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&typeof fetch==="function"&&!isFileURI(wasmBinaryFile)){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"]){throw"failed to load wasm binary file at '"+wasmBinaryFile+"'"}return response["arrayBuffer"]()}).catch(function(){return getBinary()})}return Promise.resolve().then(getBinary)}function createWasm(){var info={"a":asmLibraryArg};function receiveInstance(instance,module){var exports=instance.exports;Module["asm"]=exports;wasmMemory=Module["asm"]["h"];updateGlobalBufferAndViews(wasmMemory.buffer);wasmTable=Module["asm"]["i"];removeRunDependency("wasm-instantiate")}addRunDependency("wasm-instantiate");function receiveInstantiatedSource(output){receiveInstance(output["instance"])}function instantiateArrayBuffer(receiver){return getBinaryPromise().then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason);abort(reason)})}function instantiateAsync(){if(!wasmBinary&&typeof WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&!isFileURI(wasmBinaryFile)&&typeof fetch==="function"){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){var result=WebAssembly.instantiateStreaming(response,info);return result.then(receiveInstantiatedSource,function(reason){err("wasm streaming compile failed: "+reason);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(receiveInstantiatedSource)})})}else{return instantiateArrayBuffer(receiveInstantiatedSource)}}if(Module["instantiateWasm"]){try{var exports=Module["instantiateWasm"](info,receiveInstance);return exports}catch(e){err("Module.instantiateWasm callback failed with error: "+e);return false}}instantiateAsync().catch(readyPromiseReject);return{}}function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback(Module);continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){wasmTable.get(func)()}else{wasmTable.get(func)(callback.arg)}}else{func(callback.arg===undefined?null:callback.arg)}}}function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+UTF8ToString(condition)+", at: "+[filename?UTF8ToString(filename):"unknown filename",line,func?UTF8ToString(func):"unknown function"])}function _emscripten_memcpy_big(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)}function abortOnCannotGrowMemory(requestedSize){abort("OOM")}function _emscripten_resize_heap(requestedSize){requestedSize=requestedSize>>>0;abortOnCannotGrowMemory(requestedSize)}function _exit(status){exit(status)}var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];if(curr===0||curr===10){(stream===1?out:err)(UTF8ArrayToString(buffer,0));buffer.length=0}else{buffer.push(curr)}},varargs:undefined,get:function(){SYSCALLS.varargs+=4;var ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(ptr){var ret=UTF8ToString(ptr);return ret},get64:function(low,high){return low}};function _fd_close(fd){return 0}function _fd_seek(fd,offset_bigint,whence,newOffset){}function _fd_write(fd,iov,iovcnt,pnum){var num=0;for(var i=0;i<iovcnt;i++){var ptr=HEAP32[iov+i*8>>2];var len=HEAP32[iov+(i*8+4)>>2];for(var j=0;j<len;j++){SYSCALLS.printChar(fd,HEAPU8[ptr+j])}num+=len}HEAP32[pnum>>2]=num;return 0}__ATINIT__.push({func:function(){___wasm_call_ctors()}});var asmLibraryArg={"g":___assert_fail,"b":_emscripten_memcpy_big,"c":_emscripten_resize_heap,"f":_exit,"d":_fd_close,"e":_fd_seek,"a":_fd_write};var asm=createWasm();var ___wasm_call_ctors=Module["___wasm_call_ctors"]=function(){return(___wasm_call_ctors=Module["___wasm_call_ctors"]=Module["asm"]["j"]).apply(null,arguments)};var _futhark_context_config_new=Module["_futhark_context_config_new"]=function(){return(_futhark_context_config_new=Module["_futhark_context_config_new"]=Module["asm"]["k"]).apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return(_malloc=Module["_malloc"]=Module["asm"]["l"]).apply(null,arguments)};var _futhark_context_config_free=Module["_futhark_context_config_free"]=function(){return(_futhark_context_config_free=Module["_futhark_context_config_free"]=Module["asm"]["m"]).apply(null,arguments)};var _free=Module["_free"]=function(){return(_free=Module["_free"]=Module["asm"]["n"]).apply(null,arguments)};var _futhark_context_new=Module["_futhark_context_new"]=function(){return(_futhark_context_new=Module["_futhark_context_new"]=Module["asm"]["o"]).apply(null,arguments)};var _futhark_context_free=Module["_futhark_context_free"]=function(){return(_futhark_context_free=Module["_futhark_context_free"]=Module["asm"]["p"]).apply(null,arguments)};var _futhark_context_get_error=Module["_futhark_context_get_error"]=function(){return(_futhark_context_get_error=Module["_futhark_context_get_error"]=Module["asm"]["q"]).apply(null,arguments)};var _futhark_new_i32_2d=Module["_futhark_new_i32_2d"]=function(){return(_futhark_new_i32_2d=Module["_futhark_new_i32_2d"]=Module["asm"]["r"]).apply(null,arguments)};var _futhark_free_i32_2d=Module["_futhark_free_i32_2d"]=function(){return(_futhark_free_i32_2d=Module["_futhark_free_i32_2d"]=Module["asm"]["s"]).apply(null,arguments)};var _futhark_values_i32_2d=Module["_futhark_values_i32_2d"]=function(){return(_futhark_values_i32_2d=Module["_futhark_values_i32_2d"]=Module["asm"]["t"]).apply(null,arguments)};var _futhark_values_raw_i32_2d=Module["_futhark_values_raw_i32_2d"]=function(){return(_futhark_values_raw_i32_2d=Module["_futhark_values_raw_i32_2d"]=Module["asm"]["u"]).apply(null,arguments)};var _futhark_shape_i32_2d=Module["_futhark_shape_i32_2d"]=function(){return(_futhark_shape_i32_2d=Module["_futhark_shape_i32_2d"]=Module["asm"]["v"]).apply(null,arguments)};var _futhark_entry_main=Module["_futhark_entry_main"]=function(){return(_futhark_entry_main=Module["_futhark_entry_main"]=Module["asm"]["w"]).apply(null,arguments)};var calledRun;function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function run(args){args=args||arguments_;if(runDependencies>0){return}preRun();if(runDependencies>0)return;function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();readyPromiseResolve(Module);if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else{doRun()}}Module["run"]=run;function exit(status,implicit){if(implicit&&noExitRuntime&&status===0){return}if(noExitRuntime){}else{EXITSTATUS=status;exitRuntime();if(Module["onExit"])Module["onExit"](status);ABORT=true}quit_(status,new ExitStatus(status))}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}noExitRuntime=true;run();class Server{constructor(ctx){this.ctx=ctx;this._vars={};this._commands=["inputs","outputs","call","restore","store","free","clear","pause_profiling","unpause_profiling","report"]}_get_arg(args,i){if(i<args.length){return args[i]}else{throw"Insufficient command args"}}_get_entry_point(entry){if(entry in this.ctx.get_entry_points()){return this.ctx.get_entry_points()[entry]}else{throw"Unkown entry point: "+entry}}_check_var(vname){if(!(vname in this._vars)){throw"Unknown variable: "+vname}}_get_var(vname){this._check_var(vname);return this._vars[vname]}_cmd_inputs(args){var entry=this._get_arg(args,0);var inputs=this._get_entry_point(entry)[0];for(var i=0;i<inputs.length;i++){console.log(inputs[i])}}_cmd_outputs(args){var entry=this._get_arg(args,0);var outputs=this._get_entry_point(entry)[1];for(var i=0;i<outputs.length;i++){console.log(outputs[i])}}_cmd_dummy(args){}_cmd_free(args){for(var i=0;i<args.length;i++){var vname=args[i];this._check_var(vname);delete this._vars[vname]}}_cmd_call(args){var entry=this._get_entry_point(this._get_arg(args,0));var num_ins=entry[0].length;var num_outs=entry[1].length;var expected_len=1+num_outs+num_ins;if(args.length!=expected_len){throw"Invalid argument count, expected "+expected_len}var out_vnames=args.slice(1,num_outs+1);for(var i=0;i<out_vnames.length;i++){var out_vname=out_vnames[i];if(out_vname in this._vars){throw"Variable already exists: "+out_vname}}var in_vnames=args.slice(1+num_outs);var ins=[];for(var i=0;i<in_vnames.length;i++){ins.push(this._get_var(in_vnames[i]))}var vals=this.ctx[args[0]].apply(this.ctx,ins);for(var i=0;i<out_vnames.length;i++){this._vars[out_vnames[i]]=vals[i]}}_cmd_store(args){var fname=this._get_arg(args,0);for(var i=1;i<args.length;i++){var vname=args[i];var value=this._get_var(vname);var fs=require("fs");var bin_val=construct_binary_value(this._vars[vname]);fs.appendFileSync(fname,bin_val,"binary")}}fut_to_dim_typ(typ){var type=typ;var count=0;while(type.substr(0,2)=="[]"){count=count+1;type=type.slice(2)}return[count,type]}_cmd_restore(args){if(args.length%2==0){throw"Invalid argument count"}var fname=args[0];var args=args.slice(1);var as=args;var reader=new Reader(fname);while(as.length!=0){var vname=as[0];var typename=as[1];as=as.slice(2);if(vname in this._vars){throw"Variable already exists: "+vname}try{var value=read_value(typename,reader);if(typeof value=="number"||typeof value=="bigint"){this._vars[vname]=value}else{var shape=value[0];var arr=value[1];var dimtyp=this.fut_to_dim_typ(typename);var dim=dimtyp[0];var typ=dimtyp[1];var arg_list=[arr,...shape];var fnam="to_futhark_"+typ+"_"+dim+"d_arr";var ptr=this.ctx[fnam].apply(this.ctx,arg_list);this._vars[vname]=ptr}}catch(err){var err_msg="Failed to restore variable "+vname+".\nPossibly malformed data in "+fname+".\n";throw"Failed to restore variable "+err_msg}}skip_spaces(reader);if(reader.get_buff().length!=0){throw"Expected EOF after reading values"}}_process_line(line){var words=line.split(" ");if(words.length==0){throw"Empty line"}else{var cmd=words[0];var args=words.splice(1);if(this._commands.includes(cmd)){switch(cmd){case"inputs":this._cmd_inputs(args);break;case"outputs":this._cmd_outputs(args);break;case"call":this._cmd_call(args);break;case"restore":this._cmd_restore(args);break;case"store":this._cmd_store(args);break;case"free":this._cmd_free(args);break;case"clear":this._cmd_dummy(args);break;case"pause_profiling":this._cmd_dummy(args);break;case"unpause_profiling":this._cmd_dummy(args);break;case"report":this._cmd_dummy(args);break}}else{throw"Unknown command: "+cmd}}}run(){console.log("%%% OK");const readline=require("readline");const rl=readline.createInterface(process.stdin);rl.on("line",line=>{if(line==""){rl.close()}try{this._process_line(line);console.log("%%% OK")}catch(err){console.log("%%% FAILURE");console.log(err);console.log("%%% OK")}})}}var typToType={"  i8":Int8Array," i16":Int16Array," i32":Int32Array," i64":BigInt64Array,"  u8":Uint8Array," u16":Uint16Array," u32":Uint32Array," u64":BigUint64Array," f32":Float32Array," f64":Float64Array,"bool":Uint8Array};function binToStringArray(buff,array){for(var i=0;i<array.length;i++){array[i]=buff[i]}}function fileToBuff(fname){var readline=require("readline");var fs=require("fs");var buff=fs.readFileSync(fname);return buff}function read_binary(buff){while(buff.slice(0,1).toString().trim()==""){buff=this.buff.slice(1)}if(buff[0]!="b".charCodeAt(0)){throw"Not in binary format"}var version=buff[1];if(version!=2){throw"Not version 2"}var num_dim=buff[2];var typ=buff.slice(3,7);buff=buff.slice(7);if(num_dim==0){return read_bin_scalar(buff,typ)}else{return read_bin_array(buff,num_dim,typ)}}var typToSize={"bool":1,"  u8":1,"  i8":1," u16":2," i16":2," u32":4," i32":4," f32":4," u64":8," i64":8," f64":8};function construct_binary_value(v){var byte_len=v.bytes_per_element();var shape=v.shape();var values=v.values();var elems=1;if(shape!=0){for(var i=0;i<shape.length;i++){elems=elems*Number(shape[i])}}var num_bytes=1+1+1+4+shape.length*8+elems*byte_len*(values.length>0);var bytes=new Uint8Array(num_bytes);bytes[0]=Buffer.from("b").readUInt8();bytes[1]=2;bytes[2]=shape.length;var ftype=v.str_type();for(var i=0;i<4;i++){bytes[3+i]=ftype.charCodeAt(i)}if(shape.length>0){var sizes=new BigUint64Array(shape.length);for(var i=0;i<shape.length;i++){sizes[i]=BigInt(shape[i])}var size_bytes=new Uint8Array(sizes.buffer);bytes.set(size_bytes,7)}if(values.length==0){return Buffer.from(bytes)}var val_bytes=new Uint8Array(values.buffer,values.byteOffset,byte_len*values.length);bytes.set(val_bytes,7+shape.length*8);return Buffer.from(bytes)}class Reader{constructor(f){this.f=f;this.buff=fileToBuff(f);this.old_buff=this.buff}read_bin_array(num_dim,typ){var u8_array=new Uint8Array(num_dim*8);binToStringArray(this.buff.slice(0,num_dim*8),u8_array);var shape=new BigInt64Array(u8_array.buffer);var length=shape[0];for(var i=1;i<shape.length;i++){length=length*shape[i]}length=Number(length);var dbytes=typToSize[typ];var u8_data=new Uint8Array(length*dbytes);binToStringArray(this.buff.slice(num_dim*8,num_dim*8+dbytes*length),u8_data);var data=new typToType[typ](u8_data.buffer);var tmp_buff=this.buff.slice(num_dim*8,num_dim*8+dbytes*length);this.buff=this.buff.slice(num_dim*8+dbytes*length);return[shape,data]}read_bin_scalar(typ){var size=typToSize[typ];var u8_array=new Uint8Array(size);binToStringArray(this.buff,u8_array);var array=new typToType[typ](u8_array.buffer);this.buff=this.buff.slice(u8_array.length);return array[0]}skip_spaces(){while(this.buff.length>0&&this.buff.slice(0,1).toString().trim()==""){this.buff=this.buff.slice(1)}}read_binary(){while(this.buff.slice(0,1).toString().trim()==""){this.buff=this.buff.slice(1)}if(this.buff[0]!="b".charCodeAt(0)){throw"Not in binary format"}var version=this.buff[1];if(version!=2){throw"Not version 2"}var num_dim=this.buff[2];var typ=this.buff.slice(3,7);this.buff=this.buff.slice(7);if(num_dim==0){return this.read_bin_scalar(typ)}else{return this.read_bin_array(num_dim,typ)}}get_buff(){return this.buff}}function skip_spaces(reader){reader.skip_spaces()}function read_value(typename,reader){var val=reader.read_binary();return val}class FutharkOpaque{constructor(ctx,ptr,ffree){this.ctx=ctx;this.ptr=ptr;this.ffree=ffree}free(){this.ffree(this.ctx,this.ptr)}}Module["FutharkOpaque"]=FutharkOpaque;class FutharkArray{constructor(ctx,ptr,type_name,dim,heap,fshape,fvalues,ffree){this.ctx=ctx;this.ptr=ptr;this.type_name=type_name;this.dim=dim;this.heap=heap;this.fshape=fshape;this.fvalues=fvalues;this.ffree=ffree}futharkType(){return this.type_name}free(){this.ffree(this.ctx,this.ptr)}shape(){var s=this.fshape(this.ctx,this.ptr)>>3;return Array.from(HEAP64.subarray(s,s+this.dim))}toTypedArray(dims=this.shape()){console.assert(dims.length===this.dim,"dim=%s,dims=%s",this.dim,dims.toString());var length=Number(dims.reduce((a,b)=>a*b));var v=this.fvalues(this.ctx,this.ptr)/this.heap.BYTES_PER_ELEMENT;return this.heap.subarray(v,v+length)}toArray(){var dims=this.shape();var ta=this.toTypedArray(dims);return function nest(offs,ds){var d0=Number(ds[0]);if(ds.length===1){return Array.from(ta.subarray(offs,offs+d0))}else{var d1=Number(ds[1]);return Array.from(Array(d0),(x,i)=>nest(offs+i*d1,ds.slice(1)))}}(0,dims)}}Module["FutharkArray"]=FutharkArray;class FutharkContext{constructor(){this.cfg=_futhark_context_config_new();this.ctx=_futhark_context_new(this.cfg);this.entry_points={"main":[["i64","i64","i32","f32","f32","f32","f32"],["[][]i32"]]}}free(){_futhark_context_free(this.ctx);_futhark_context_config_free(this.cfg)}get_entry_points(){return this.entry_points}get_error(){var ptr=_futhark_context_get_error(this.ctx);var len=HEAP8.subarray(ptr).indexOf(0);var str=String.fromCharCode(...HEAP8.subarray(ptr,ptr+len));_free(ptr);return str}new_i32_2d_from_jsarray(array2d){return this.new_i32_2d(array2d.flat(),array2d.length,array2d[0].length)}new_i32_2d(array,d0,d1){console.assert(array.length===d0*d1,"len=%s,dims=%s",array.length,[d0,d1].toString());var copy=_malloc(array.length<<2);HEAP32.set(array,copy>>2);var ptr=_futhark_new_i32_2d(this.ctx,copy,BigInt(d0),BigInt(d1));_free(copy);return this.new_i32_2d_from_ptr(ptr)}new_i32_2d_from_ptr(ptr){return new FutharkArray(this.ctx,ptr,"i32",2,HEAP32,_futhark_shape_i32_2d,_futhark_values_raw_i32_2d,_futhark_free_i32_2d)}main(in0,in1,in2,in3,in4,in5,in6){var out=[4].map(n=>_malloc(n));var to_free=[];var do_free=()=>{out.forEach(_free);to_free.forEach(f=>f.free())};if(_futhark_entry_main(this.ctx,...out,in0,in1,in2,in3,in4,in5,in6)>0){do_free();throw this.get_error()}var result0=this.new_i32_2d_from_ptr(HEAP32[out[0]>>2]);do_free();return result0}}Module["FutharkContext"]=FutharkContext;


  return createFutharkModule.ready
}
);
})();
if (typeof exports === 'object' && typeof module === 'object')
  module.exports = createFutharkModule;
else if (typeof define === 'function' && define['amd'])
  define([], function() { return createFutharkModule; });
else if (typeof exports === 'object')
  exports["createFutharkModule"] = createFutharkModule;
